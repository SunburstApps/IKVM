<?xml version="1.0" encoding="UTF-8" ?>
<Project>
  <Target Name="_PrepareJavac" DependsOnTargets="CreateJavacSourceListFile">
    <ReadLinesFromFile File="$(IntermediateOutputPath)/javac.rsp">
      <Output TaskParameter="Lines" ItemName="JavaSource" />
    </ReadLinesFromFile>

    <ItemGroup>
      <!--
      Note: While this doesn't match all of the class files generated by the build,
      it matches enough of them for the MSBuild freshness check to succeed.
      -->
      <JavaClassFile Include="@(JavaSource -> '%(Directory)%(FileName).class')" />
    </ItemGroup>
  </Target>
  
  <Target Name="Javac" DependsOnTargets="CompileBuildTasksAssembly;_PrepareJavac;GeneratePropertyConstants;CreateJavacSourceListFile;GenerateStubJars"
    Inputs="@(JavaSource)" Outputs="@(JavaClassFile)">
    <Javac ExtraArguments="-g;-nowarn;-implicit:none;-parameters" ToolMode="System"
      BootClassPath="@(StubJar)" ClassPath="dummy" SourceFiles="@(JavaSource)" WorkingDirectory="$(MSBuildProjectDirectory)" />

    <ItemGroup>
      <FileWrites Include="@(JavaClassFile)" />
    </ItemGroup>
  </Target>
</Project>
